# API Reference - Receipt Parser Yomi Bot

## Table of Contents
- [Bot Module (`bot.py`)](#bot-module)
- [Receipt Processor (`receipt_processor.py`)](#receipt-processor)
- [OpenAI Vision Parser (`openai_vision.py`)](#openai-vision-parser)
- [QR Parser (`qr_parser.py`)](#qr-parser)
- [OCR Handler (`ocr_handler.py`)](#ocr-handler)
- [Drive Handler (`drive_handler.py`)](#drive-handler)
- [Sheets Handler (`sheets_handler.py`)](#sheets-handler)
- [Google Auth (`google_auth.py`)](#google-auth)
- [Data Structures](#data-structures)

---

## Bot Module

### `get_or_init_user_structure(chat_id, username=None, chat_title=None)`
–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫/—Ç–∞–±–ª–∏—Ü –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `chat_id`: ID —á–∞—Ç–∞ Telegram
- `username`: Username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `chat_title`: –ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø–æ–≤–æ–≥–æ —á–∞—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –°–ª–æ–≤–∞—Ä—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ:
```python
{
    'user_folder_id': 'xxx',
    'user_folder_link': 'https://...',
    'user_sheet_id': 'xxx',
    'user_sheet_link': 'https://...',
    'chat_name': '@username' –∏–ª–∏ '–ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞'
}
```

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ–∑–¥–∞–µ—Ç –ª–∏—á–Ω—É—é –ø–∞–ø–∫—É –∏ —Ç–∞–±–ª–∏—Ü—É –Ω–∞ Google Drive.

---

### `async start(update: Update, context: ContextTypes.DEFAULT_TYPE)`
–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã `/start`.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `update`: Telegram Update –æ–±—ä–µ–∫—Ç
- `context`: –ö–æ–Ω—Ç–µ–∫—Å—Ç –±–æ—Ç–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** None

**–û–ø–∏—Å–∞–Ω–∏–µ:** 
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–∞–ø–∫–∞ –∏ —Ç–∞–±–ª–∏—Ü–∞)
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
- –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ –ª–∏—á–Ω—É—é –ø–∞–ø–∫—É –∏ —Ç–∞–±–ª–∏—Ü—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –õ–æ–≥–∏—Ä—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞)

---

### `async help_command(update: Update, context: ContextTypes.DEFAULT_TYPE)`
–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã `/help`.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `update`: Telegram Update –æ–±—ä–µ–∫—Ç
- `context`: –ö–æ–Ω—Ç–µ–∫—Å—Ç –±–æ—Ç–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** None

**–û–ø–∏—Å–∞–Ω–∏–µ:** –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–ø—Ä–∞–≤–∫—É –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∫–æ–º–∞–Ω–¥ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π.

---

### `async full_analyze(update: Update, context: ContextTypes.DEFAULT_TYPE)`
–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã `/full_analyze` - –º–∞—Å—Å–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ–∫–æ–≤.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `update`: Telegram Update –æ–±—ä–µ–∫—Ç
- `context`: –ö–æ–Ω—Ç–µ–∫—Å—Ç –±–æ—Ç–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** None

**–û–ø–∏—Å–∞–Ω–∏–µ:**
1. –°–æ–∑–¥–∞–µ—Ç –ø–∞–ø–∫—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≤–Ω—É—Ç—Ä–∏ –ø–∞–ø–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏: "{chat_name} –ì–ì–ì–ì-–ú–ú-–î–î –ß–ß-–ú–ú"
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –ø–∞–ø–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç —á–µ–∫–∏ –≤ —ç—Ç—É –ø–∞–ø–∫—É
5. –ù–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–ù–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑"
6. –ë–æ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

### `async handle_photo(update: Update, context: ContextTypes.DEFAULT_TYPE)`
–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —á–µ–∫–æ–≤.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `update`: Telegram Update –æ–±—ä–µ–∫—Ç
- `context`: –ö–æ–Ω—Ç–µ–∫—Å—Ç –±–æ—Ç–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** None

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –ü–æ–ª—É—á–∞–µ—Ç —Ñ–æ—Ç–æ —á–µ–∫–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–µ–∫ —á–µ—Ä–µ–∑ OpenAI Vision
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–∞ Drive –∏ –≤ Sheets –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è**
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏

**Workflow:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–æ—Ç–æ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è
2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–æ—Ç–æ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
4. –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ `processor.process_receipt_image()`
5. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ `processor.upload_and_save()`
6. –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
7. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
- –£–¥–∞–ª—è–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–∏ –æ—à–∏–±–∫–µ
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –õ–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

---

### `async process_analysis_folder(query, folder_info)`
–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ –ø–∞–ø–∫–∏ –∞–Ω–∞–ª–∏–∑–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `query`: Callback query –æ–±—ä–µ–∫—Ç
- `folder_info`: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–ø–∫–µ –∞–Ω–∞–ª–∏–∑–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** None

**–û–ø–∏—Å–∞–Ω–∏–µ:**
1. –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –∏–∑ –ø–∞–ø–∫–∏ –Ω–∞ Drive
2. –°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞
3. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª:
   - –°–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–∞–π–ª
   - –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç PDF –≤ JPG (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–µ—Ä–µ–∑ `processor.process_receipt_image()`
   - –î–æ–±–∞–≤–ª—è–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü—É –∞–Ω–∞–ª–∏–∑–∞
   - –î–æ–±–∞–≤–ª—è–µ—Ç –≤ –∫–æ—Ä–Ω–µ–≤—É—é —Ç–∞–±–ª–∏—Ü—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Å—Å—ã–ª–∫–æ–π –Ω–∞ –ø–∞–ø–∫—É
4. –§–æ—Ä–º–∏—Ä—É–µ—Ç –∏—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç —Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π

---

### `async button_callback(update: Update, context: ContextTypes.DEFAULT_TYPE)`
–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ inline-–∫–Ω–æ–ø–∫–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `update`: Telegram Update –æ–±—ä–µ–∫—Ç
- `context`: –ö–æ–Ω—Ç–µ–∫—Å—Ç –±–æ—Ç–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** None

**Callback Data:**
- `analyze_{chat_id}` - –∑–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–∞–ø–∫–∏ –∞–Ω–∞–ª–∏–∑–∞

**–û–ø–∏—Å–∞–Ω–∏–µ:** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –º–∞—Å—Å–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —á–µ–∫–æ–≤.

---

## Receipt Processor

### `class ReceiptProcessor`

#### `__init__()`
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ —á–µ–∫–æ–≤.

**–°–æ–∑–¥–∞–µ—Ç:**
- `self.drive`: DriveHandler
- `self.sheets`: SheetsHandler

---

#### `process_receipt_image(image_path: str) -> tuple[bool, dict, str]`
–ü–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ–∫–∞ –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `image_path`: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- `success` (bool): True –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ
- `data` (dict): –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ —á–µ–∫–∞
- `message` (str): –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –∏–ª–∏ "OK"

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ QR-–∫–æ–¥–∞ —á–µ—Ä–µ–∑ `extract_qr_from_image()`
2. –ü–∞—Ä—Å–∏–Ω–≥ URL –§–ù–° —á–µ—Ä–µ–∑ `parse_fns_url()`
3. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ OpenAI Vision
4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ URL –∏–∑ QR –≤ –¥–∞–Ω–Ω—ã–µ
5. –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ `validate_and_clean_data()`

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```python
processor = ReceiptProcessor()
success, data, message = processor.process_receipt_image('receipt.jpg')
if success:
    print(data)
else:
    print(f"Error: {message}")
```

---

#### `upload_and_save(image_path: str, receipt_data: dict) -> tuple[bool, str]`
–ó–∞–≥—Ä—É–∑–∫–∞ —á–µ–∫–∞ –Ω–∞ Drive –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Sheets.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `image_path`: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
- `receipt_data`: –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ —á–µ–∫–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- `success` (bool): True –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ
- `result_message` (str): –°–æ–æ–±—â–µ–Ω–∏–µ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ `drive.upload_file()`
2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ Drive –≤ `receipt_data`
3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Sheets —á–µ—Ä–µ–∑ `sheets.add_receipt_data()`

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
```
‚úÖ –ß–µ–∫ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω!

üìÅ –§–∞–π–ª: –°–∞–±–∞—Ç–∞—Ä–æ–≤ –ê.–ì. 13.08.2025.jpg
üìÇ –ü–∞–ø–∫–∞: 9705246070/08-2025
üîó Drive: https://drive.google.com/...
üìä –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Ç–∞–±–ª–∏—Ü—É
```

---

## User Manager

### `class UserManager`

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –ø–∞–ø–æ–∫ –∏ —Ç–∞–±–ª–∏—Ü –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

#### `__init__()`
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ Google Drive –∏ Sheets.

**–°–æ–∑–¥–∞–µ—Ç:**
- `self.drive_service`: Google Drive v3 service
- `self.sheets_service`: Google Sheets v4 service
- `self.root_folder_id`: ID –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–∏ –∏–∑ .env

---

#### `get_chat_name(chat_id, username=None, chat_title=None) -> str`
–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –¥–ª—è –ø–∞–ø–∫–∏/—Ç–∞–±–ª–∏—Ü—ã.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `chat_id`: ID —á–∞—Ç–∞
- `username`: Username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–ª—è –ª–∏—á–Ω—ã—Ö —á–∞—Ç–æ–≤)
- `chat_title`: –ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞ (–¥–ª—è –≥—Ä—É–ø–ø–æ–≤—ã—Ö —á–∞—Ç–æ–≤)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –°—Ç—Ä–æ–∫—É —Ç–∏–ø–∞ "@username" –∏–ª–∏ "–ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞" –∏–ª–∏ "user_{chat_id}"

---

#### `get_or_create_user_structure(chat_id, chat_name) -> dict`
–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫ –∏ —Ç–∞–±–ª–∏—Ü –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `chat_id`: ID —á–∞—Ç–∞
- `chat_name`: –ò–º—è –¥–ª—è –ø–∞–ø–∫–∏/—Ç–∞–±–ª–∏—Ü—ã

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```python
{
    'user_folder_id': 'xxx',
    'user_folder_link': 'https://...',
    'user_sheet_id': 'xxx',
    'user_sheet_link': 'https://...'
}
```

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü–æ–∏—Å–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ø–∞–ø–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –ø–∞–ø–∫–∏ (–µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞)
3. –ü–æ–∏—Å–∫ –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ—Ä–Ω–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã –≤ –ø–∞–ø–∫–µ
4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Ç–∞–±–ª–∏—Ü—ã
5. –í–æ–∑–≤—Ä–∞—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ

---

## Analysis Sheet Handler

### `class AnalysisSheetHandler`

Handler –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —á–µ–∫–æ–≤.

#### `__init__()`
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ spreadsheet_id - —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã.

**–°–æ–∑–¥–∞–µ—Ç:**
- `self.service`: Google Sheets v4 service
- `self.drive_service`: Google Drive v3 service

---

#### `create_analysis_spreadsheet(title, folder_id) -> tuple[str, str]`
–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `title`: –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
- `folder_id`: ID –ø–∞–ø–∫–∏ Drive –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `(spreadsheet_id, web_link)`

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã —Å –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω–æ–π –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–æ–π
2. –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ —É–∫–∞–∑–∞–Ω–Ω—É—é –ø–∞–ø–∫—É
3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
4. –í–æ–∑–≤—Ä–∞—Ç ID –∏ —Å—Å—ã–ª–∫–∏

---

#### `add_receipt_to_sheet(spreadsheet_id, data) -> dict`
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —á–µ–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü—É –∞–Ω–∞–ª–∏–∑–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `spreadsheet_id`: ID —Ç–∞–±–ª–∏—Ü—ã
- `data`: –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ —á–µ–∫–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ append

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:**
```python
[
    data.get('date'),
    data.get('full_name'),
    data.get('buyer_inn'),
    data.get('services'),
    extract_amount_number(data.get('amount')),
    data.get('status'),
    data.get('fns_url'),
    data.get('drive_link'),
    data.get('error_details')
]
```

**–î–∏–∞–ø–∞–∑–æ–Ω:** `A:I` (9 –∫–æ–ª–æ–Ω–æ–∫)

---

## Statistics Handler

### `class StatisticsHandler`

Handler –¥–ª—è —Å–±–æ—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞.

#### `__init__()`
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º STATISTICS_SHEET_ID –∏–∑ .env.

**–°–æ–∑–¥–∞–µ—Ç:**
- `self.service`: Google Sheets v4 service
- `self.drive_service`: Google Drive v3 service
- `self.spreadsheet_id`: ID —Ç–∞–±–ª–∏—Ü—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

**Raises:** ValueError –µ—Å–ª–∏ STATISTICS_SHEET_ID –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env

---

#### `log_action(user_id, username, action, result, details="") -> None`
–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `user_id`: Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `username`: Username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `action`: –¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è ("/start", "–û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ–∫–∞", "/full_analyze" –∏ —Ç.–¥.)
- `result`: "—É—Å–ø–µ—Ö" –∏–ª–∏ "–æ—à–∏–±–∫–∞"
- `details`: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ –ª–∏—Å—Ç "–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π":**
```python
[
    timestamp_msk,
    user_id,
    username,
    action,
    result,
    details
]
```

---

#### `update_user_stats(user_id, username, action_type, success=True) -> None`
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `user_id`: Telegram ID
- `username`: Username
- `action_type`: 'receipt' –∏–ª–∏ 'folder_analysis'
- `success`: –£—Å–ø–µ—à–Ω–æ –ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

**–û–±–Ω–æ–≤–ª—è–µ—Ç –≤ –ª–∏—Å—Ç–µ "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π":**
- –í—Å–µ–≥–æ —á–µ–∫–æ–≤
- –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ
- –û—à–∏–±–æ–∫
- –î–Ω–µ–π –∞–∫—Ç–∏–≤–µ–Ω
- –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

---

#### `setup_statistics_sheets() -> None`
–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –¥–ª—è —Ç–∞–±–ª–∏—Ü —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–∑–∞–ø—É—Å–∫–∞—Ç—å –æ–¥–∏–Ω —Ä–∞–∑).

**–°–æ–∑–¥–∞–µ—Ç –¥–≤–∞ –ª–∏—Å—Ç–∞:**
1. "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π" - –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
2. "–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π" - –¥–µ—Ç–∞–ª—å–Ω—ã–π –ª–æ–≥ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π

---

## OpenAI Vision Parser

### `class OpenAIVisionParser`

#### `__init__()`
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è OpenAI –∫–ª–∏–µ–Ω—Ç–∞.

**–¢—Ä–µ–±—É–µ—Ç:** `OPENAI_API_KEY` –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

---

#### `encode_image(image_path: str) -> str`
–ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ base64.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `image_path`: –ü—É—Ç—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** Base64-–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞

---

#### `parse_receipt(image_path: str) -> tuple[bool, dict, str]`
–ü–∞—Ä—Å–∏–Ω–≥ —á–µ–∫–∞ —á–µ—Ä–µ–∑ GPT-4o-mini Vision.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `image_path`: –ü—É—Ç—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é —á–µ–∫–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- `success` (bool): True –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ
- `data` (dict): –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- `message` (str): "OK" –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏

**–ú–æ–¥–µ–ª—å:** `gpt-4o-mini`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
- `max_tokens`: 500
- `temperature`: 0 (–¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏)

**–ò–∑–≤–ª–µ–∫–∞–µ–º—ã–µ –ø–æ–ª—è:**
```json
{
  "full_name": "–§–∞–º–∏–ª–∏—è –ò.–û.",
  "amount": "7 021.00 ‚ÇΩ",
  "services": "–∞–∫—Ç–µ—Ä—Å–∫–∏–µ —É—Å–ª—É–≥–∏",
  "seller_inn": "123456789012",
  "buyer_inn": "9705246070",
  "date": "13.08.2025",
  "status": "–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω",
  "date_obj": datetime
}
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
- JSONDecodeError: –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ –≤–∞–ª–∏–¥–Ω—ã–π JSON
- Exception: –æ–±—â–∏–µ –æ—à–∏–±–∫–∏ OpenAI API

---

## QR Parser

### `extract_qr_from_image(image_path: str) -> str | None`
–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ URL –∏–∑ QR-–∫–æ–¥–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `image_path`: –ü—É—Ç—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** URL —Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ None

**–ú–µ—Ç–æ–¥—ã:**
1. –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ PIL + pyzbar
2. –ï—Å–ª–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ: —É–ª—É—á—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ OpenCV + –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ

**OpenCV –æ–±—Ä–∞–±–æ—Ç–∫–∞:**
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ grayscale
- –≠–∫–≤–∞–ª–∏–∑–∞—Ü–∏—è –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã (`cv2.equalizeHist`)

---

### `parse_fns_url(url: str) -> dict | None`
–ü–∞—Ä—Å–∏–Ω–≥ URL –§–ù–° –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `url`: URL —á–µ–∫–∞ –§–ù–°

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–ª–∏ None

**–§–æ—Ä–º–∞—Ç URL:**
```
https://lknpd.nalog.ru/api/v1/receipt/{INN}/{receipt_id}/print
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```python
{
    'seller_inn': '123456789012',
    'receipt_id': 'abc123xyz',
    'fns_url': 'https://lknpd.nalog.ru/...'
}
```

**Regex –ø–∞—Ç—Ç–µ—Ä–Ω:**
```python
r'https://lknpd\.nalog\.ru/api/v1/receipt/(\d+)/([a-zA-Z0-9]+)'
```

---

## OCR Handler

### `extract_text_from_image(image_path: str) -> str`
–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ OCR (Tesseract).

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `image_path`: –ü—É—Ç—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç

**–Ø–∑—ã–∫:** `rus` (—Ä—É—Å—Å–∫–∏–π)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω–æ, –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ - OpenAI Vision.

---

### `parse_receipt_data(ocr_text: str) -> dict`
–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ OCR —Ç–µ–∫—Å—Ç–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `ocr_text`: –¢–µ–∫—Å—Ç, –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π —á–µ—Ä–µ–∑ OCR

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏

**Regex –ø–∞—Ç—Ç–µ—Ä–Ω—ã:**
- –§–ò–û: `([–ê-–Ø–Å][–∞-—è—ë]+)\s+([–ê-–Ø–Å][–∞-—è—ë]+)\s+([–ê-–Ø–Å][–∞-—è—ë]+)`
- –°—É–º–º–∞: `–ò—Ç–æ–≥–æ\s*([\d\s]+[,.]?\d*)\s*[‚ÇΩ–†]`
- –ò–ù–ù: `\b(\d{12}|\d{10})\b`
- –î–∞—Ç–∞: `(\d{2}\.\d{2}\.\d{4})`
- –£—Å–ª—É–≥–∏: `1\s+([–∞-—è—ë\s]+)\s+[\d\s,]+`

---

### `validate_and_clean_data(data: dict) -> tuple[bool, str]`
–í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ–∫–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `data`: –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ —á–µ–∫–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- `is_valid` (bool): True –µ—Å–ª–∏ –≤–∞–ª–∏–¥–Ω–æ
- `message` (str): –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ –∏–ª–∏ "OK"

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:**
- `full_name`
- `amount`
- `buyer_inn`
- `date`

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- –ò–ù–ù: 10 –∏–ª–∏ 12 —Ü–∏—Ñ—Ä (`^\d{10}$|^\d{12}$`)

---

## Drive Handler

### `class DriveHandler`

#### `__init__(root_folder_id: str)`
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Drive handler.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `root_folder_id`: ID –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–∏ –Ω–∞ Google Drive (–ø–∞–ø–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –∫–æ—Ä–Ω–µ–≤–∞—è –¥–ª—è –≤—Å–µ—Ö)

**–°–æ–∑–¥–∞–µ—Ç:** Google Drive v3 service

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í –º—É–ª—å—Ç–∏–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º —Ä–µ–∂–∏–º–µ root_folder_id - —ç—Ç–æ –ø–∞–ø–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

---

#### `get_or_create_folder(folder_name: str, parent_id: str) -> str`
–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `folder_name`: –ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏
- `parent_id`: ID —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –ø–∞–ø–∫–∏

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** ID –ø–∞–ø–∫–∏

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–∏—Å–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ø–∞–ø–∫–∏ –ø–æ –∏–º–µ–Ω–∏ –∏ —Ä–æ–¥–∏—Ç–µ–ª—é
2. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π
3. –í–æ–∑–≤—Ä–∞—Ç ID

**Drive API –∑–∞–ø—Ä–æ—Å—ã:**
- `files().list()` –¥–ª—è –ø–æ–∏—Å–∫–∞
- `files().create()` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è

---

#### `upload_file(file_path: str, buyer_inn: str, receipt_date: datetime, full_name: str) -> dict`
–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –Ω–∞ Drive.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `file_path`: –ü—É—Ç—å –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Ñ–∞–π–ª—É
- `buyer_inn`: –ò–ù–ù –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
- `receipt_date`: –î–∞—Ç–∞ —á–µ–∫–∞ (datetime –æ–±—ä–µ–∫—Ç)
- `full_name`: –§–ò–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ "–§–∞–º–∏–ª–∏—è –ò.–û."

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```python
{
    'file_id': 'abc123...',
    'web_link': 'https://drive.google.com/...',
    'filename': '–°–∞–±–∞—Ç–∞—Ä–æ–≤ –ê.–ì. 13.08.2025.jpg',
    'folder_path': '9705246070/08-2025'
}
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫:**
```
–ö–æ—Ä–Ω–µ–≤–∞—è –ø–∞–ø–∫–∞ (GOOGLE_DRIVE_FOLDER_ID –∏–∑ .env)
‚îî‚îÄ‚îÄ @username (–ø–∞–ø–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
    ‚îú‚îÄ‚îÄ {buyer_inn}
    ‚îÇ   ‚îî‚îÄ‚îÄ {MM-YYYY}
    ‚îÇ       ‚îî‚îÄ‚îÄ {full_name} {DD.MM.YYYY}.{ext}
    ‚îî‚îÄ‚îÄ @username 2026-01-16 10-30 (–ø–∞–ø–∫–∞ –∞–Ω–∞–ª–∏–∑–∞)
```

**–ü—Ä–∏–º–µ—Ä:**
```
–ö–æ—Ä–Ω–µ–≤–∞—è –ø–∞–ø–∫–∞
‚îî‚îÄ‚îÄ @johndoe
    ‚îú‚îÄ‚îÄ 9705246070
    ‚îÇ   ‚îî‚îÄ‚îÄ 08-2025
    ‚îÇ       ‚îî‚îÄ‚îÄ –°–∞–±–∞—Ç–∞—Ä–æ–≤ –ê.–ì. 13.08.2025.jpg
    ‚îî‚îÄ‚îÄ @johndoe 2026-01-16 10-30
        ‚îî‚îÄ‚îÄ —Ñ–∞–π–ª—ã –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
```

---

#### `create_analysis_folder(folder_name: str) -> tuple[str, str]`
–°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –≤–Ω—É—Ç—Ä–∏ –ø–∞–ø–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `folder_name`: –ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "@username 2026-01-16 10-30")

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `(folder_id, web_link)`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –°–æ–∑–¥–∞–µ—Ç –ø–∞–ø–∫—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –ø–µ—Ä–µ–¥ –º–∞—Å—Å–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π.

---

#### `list_files_in_folder(folder_id: str) -> list`
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ –ø–∞–ø–∫–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `folder_id`: ID –ø–∞–ø–∫–∏ –Ω–∞ Drive

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤:
```python
[
    {'id': '...', 'name': '...', 'mimeType': '...'},
    ...
]
```

**–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (JPEG, PNG, WebP, HEIC) –∏ PDF —Ñ–∞–π–ª—ã.

---

#### `download_file(file_id: str, destination_path: str) -> None`
–°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å Drive.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `file_id`: ID —Ñ–∞–π–ª–∞ –Ω–∞ Drive
- `destination_path`: –ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ –º–∞—Å—Å–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ.

---

## Sheets Handler

### `class SheetsHandler`

#### `__init__(spreadsheet_id: str)`
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Sheets handler.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `spreadsheet_id`: ID Google Sheets —Ç–∞–±–ª–∏—Ü—ã

**–°–æ–∑–¥–∞–µ—Ç:** Google Sheets v4 service

---

#### `add_receipt_data(data: dict, source_link=None, source_name=None) -> dict`
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —á–µ–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü—É.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `data`: –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ —á–µ–∫–∞
- `source_link`: –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–∞–ø–∫—É –∞–Ω–∞–ª–∏–∑–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `source_name`: –ù–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ append

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:**
```python
{
    'date': '13.08.2025',
    'full_name': '–°–∞–±–∞—Ç–∞—Ä–æ–≤ –ê.–ì.',
    'buyer_inn': '9705246070',
    'services': '–∞–∫—Ç–µ—Ä—Å–∫–∏–µ —É—Å–ª—É–≥–∏',
    'amount': '7 021.00 ‚ÇΩ',
    'status': '–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω',
    'fns_url': 'https://...',
    'drive_link': 'https://...'
}
```

**–î–∏–∞–ø–∞–∑–æ–Ω:** `A:J` (10 –∫–æ–ª–æ–Ω–æ–∫)

**–ö–æ–ª–æ–Ω–∫–∏:**
- A: –î–∞—Ç–∞
- B: –§–ò–û
- C: –ò–ù–ù –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
- D: –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —É—Å–ª—É–≥
- E: –°—É–º–º–∞ (—á–∏—Å–ª–æ)
- F: –°—Ç–∞—Ç—É—Å
- G: –°—Å—ã–ª–∫–∞ –§–ù–°
- H: –°—Å—ã–ª–∫–∞ Drive
- I: –î–æ–±–∞–≤–ª–µ–Ω–æ (–ú–°–ö) - timestamp
- J: –ò—Å—Ç–æ—á–Ω–∏–∫ - "–ü—Ä—è–º–∞—è –∑–∞–≥—Ä—É–∑–∫–∞" –∏–ª–∏ –≥–∏–ø–µ—Ä—Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–∞–ø–∫—É –∞–Ω–∞–ª–∏–∑–∞

**–ú–µ—Ç–æ–¥:** `values().append()` —Å `valueInputOption='USER_ENTERED'`

---

#### `setup_headers() -> dict`
–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Ç–∞–±–ª–∏—Ü—ã.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ update

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**
| A | B | C | D | E | F | G | H | I | J |
|---|---|---|---|---|---|---|---|---|---|
| –î–∞—Ç–∞ | –§–ò–û | –ò–ù–ù –ø–æ–∫—É–ø–∞—Ç–µ–ª—è | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —É—Å–ª—É–≥ | –°—É–º–º–∞ | –°—Ç–∞—Ç—É—Å | –°—Å—ã–ª–∫–∞ –§–ù–° | –°—Å—ã–ª–∫–∞ Drive | –î–æ–±–∞–≤–ª–µ–Ω–æ (–ú–°–ö) | –ò—Å—Ç–æ—á–Ω–∏–∫ |

**–î–∏–∞–ø–∞–∑–æ–Ω:** `A1:J1`

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ó–∞–ø—É—Å–∫–∞—Ç—å –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

---

## Google Auth

### `get_google_credentials() -> Credentials`
–ü–æ–ª—É—á–µ–Ω–∏–µ Google API credentials.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** Google OAuth2 Credentials –æ–±—ä–µ–∫—Ç

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è `token.pickle`
2. –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö credentials
3. –ï—Å–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã:
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ refresh_token
   - –ò–ª–∏ –Ω–æ–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä
4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `token.pickle`

**SCOPES:**
- `https://www.googleapis.com/auth/drive.file`
- `https://www.googleapis.com/auth/spreadsheets`

**–§–∞–π–ª—ã:**
- `credentials.json` - OAuth 2.0 client secrets (–∏–∑ Google Cloud Console)
- `token.pickle` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

**OAuth Flow:**
1. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫: –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è –≤ Google
3. –¢–æ–∫–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
4. –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—É—Å–∫–∏: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

---

## Data Structures

### Receipt Data

–û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ–∫–∞:

```python
receipt_data = {
    # –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
    'full_name': str,      # "–§–∞–º–∏–ª–∏—è –ò.–û."
    'amount': str,         # "7 021.00 ‚ÇΩ"
    'buyer_inn': str,      # "9705246070" (10 –∏–ª–∏ 12 —Ü–∏—Ñ—Ä)
    'date': str,           # "13.08.2025" (dd.mm.yyyy)
    
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
    'services': str,       # "–∞–∫—Ç–µ—Ä—Å–∫–∏–µ —É—Å–ª—É–≥–∏"
    'seller_inn': str,     # "123456789012" (12 —Ü–∏—Ñ—Ä)
    'status': str,         # "–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω" | "–ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω"
    'fns_url': str,        # "https://lknpd.nalog.ru/..."
    'drive_link': str,     # "https://drive.google.com/..." (–ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏)
    
    # –°–ª—É–∂–µ–±–Ω—ã–µ –ø–æ–ª—è
    'date_obj': datetime,  # –û–±—ä–µ–∫—Ç datetime –¥–ª—è Drive
}
```

### Media Group Info

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–ª—å–±–æ–º–∞–º–∏:

```python
media_group_info = {
    'photos': list,        # –°–ø–∏—Å–æ–∫ PhotoSize –æ–±—ä–µ–∫—Ç–æ–≤
    'user_id': int,        # ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    'chat_id': int,        # ID —á–∞—Ç–∞
    'notified': bool,      # –§–ª–∞–≥ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    'processing': bool,    # –§–ª–∞–≥ –æ–±—Ä–∞–±–æ—Ç–∫–∏
}
```

### Pending Receipt

–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º–æ–≥–æ —á–µ–∫–∞:

```python
pending_receipt = {
    'data': dict,          # receipt_data
    'file_path': str,      # –ü—É—Ç—å –∫ –≤—Ä–µ–º–µ–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É
}
```

---

## Error Handling

### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

#### OpenAI Vision
```python
# JSONDecodeError
return False, {}, f"–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: {str(e)}"

# General Exception
return False, {}, f"–û—à–∏–±–∫–∞ OpenAI: {str(e)}"
```

#### QR Parser
```python
# –ï—Å–ª–∏ QR –Ω–µ –Ω–∞–π–¥–µ–Ω
return None

# Exception
print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ QR: {e}")
return None
```

#### Drive Upload
```python
# Exception –≤ upload_and_save
return False, f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: {str(e)}"
```

#### Validation
```python
# –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–µ
return False, f"–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–µ: {field}"

# –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ò–ù–ù
return False, "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ò–ù–ù –ø–æ–∫—É–ø–∞—Ç–µ–ª—è"
```

---

## Usage Examples

### –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏

```python
from receipt_processor import ReceiptProcessor

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
processor = ReceiptProcessor()

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
success, data, message = processor.process_receipt_image('receipt.jpg')

if success:
    print(f"–î–∞–Ω–Ω—ã–µ –∏–∑–≤–ª–µ—á–µ–Ω—ã: {data}")
    
    # –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ Drive –∏ –≤ Sheets
    upload_success, result = processor.upload_and_save('receipt.jpg', data)
    
    if upload_success:
        print(result)
    else:
        print(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: {result}")
else:
    print(f"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏: {message}")
```

### –¢–æ–ª—å–∫–æ Vision –ø–∞—Ä—Å–∏–Ω–≥

```python
from openai_vision import OpenAIVisionParser

parser = OpenAIVisionParser()
success, data, message = parser.parse_receipt('receipt.jpg')

if success:
    print(data['full_name'])
    print(data['amount'])
```

### –¢–æ–ª—å–∫–æ QR –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ

```python
from qr_parser import extract_qr_from_image, parse_fns_url

# –ò–∑–≤–ª–µ—á—å URL
url = extract_qr_from_image('receipt.jpg')

# –ü–∞—Ä—Å–∏—Ç—å URL
if url:
    qr_data = parse_fns_url(url)
    print(qr_data['seller_inn'])
    print(qr_data['receipt_id'])
```

### –¢–æ–ª—å–∫–æ Drive –∑–∞–≥—Ä—É–∑–∫–∞

```python
from drive_handler import DriveHandler
from datetime import datetime

drive = DriveHandler('your_folder_id')
result = drive.upload_file(
    file_path='receipt.jpg',
    buyer_inn='9705246070',
    receipt_date=datetime(2025, 8, 13),
    full_name='–°–∞–±–∞—Ç–∞—Ä–æ–≤ –ê.–ì.'
)

print(result['web_link'])
```

### –¢–æ–ª—å–∫–æ Sheets —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

```python
from sheets_handler import SheetsHandler

sheets = SheetsHandler('your_sheet_id')
sheets.add_receipt_data({
    'date': '13.08.2025',
    'full_name': '–°–∞–±–∞—Ç–∞—Ä–æ–≤ –ê.–ì.',
    'buyer_inn': '9705246070',
    'services': '–∞–∫—Ç–µ—Ä—Å–∫–∏–µ —É—Å–ª—É–≥–∏',
    'amount': '7 021.00 ‚ÇΩ',
    'status': '–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω',
    'fns_link': 'https://...',
    'drive_link': 'https://...'
})
```

---

## Rate Limits & Quotas

### OpenAI API
- **–ú–æ–¥–µ–ª—å:** gpt-4o-mini
- **–°—Ç–æ–∏–º–æ—Å—Ç—å:** ~$0.0003 –Ω–∞ –∑–∞–ø—Ä–æ—Å
- **Rate limit:** –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∞—Ä–∏—Ñ–Ω–æ–≥–æ –ø–ª–∞–Ω–∞

### Google Drive API
- **Queries per day:** 1,000,000,000
- **Queries per 100 seconds per user:** 1,000

### Google Sheets API
- **Read requests per minute per user:** 60
- **Write requests per minute per user:** 60

### Telegram Bot API
- **Messages per second:** 30
- **Messages per second to same chat:** 1
- **No cost**

---

## Environment Variables

| Variable | Description | Required | Example |
|----------|-------------|----------|---------|
| `TELEGRAM_BOT_TOKEN` | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ | ‚úÖ | `123456:ABC-DEF...` |
| `GOOGLE_DRIVE_FOLDER_ID` | ID –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–∏ Drive (–¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π) | ‚úÖ | `1aB2cD3eF4...` |
| `GOOGLE_SHEET_ID` | ID Google Sheets —Ç–∞–±–ª–∏—Ü—ã (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –º—É–ª—å—Ç–∏–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º —Ä–µ–∂–∏–º–µ) | ‚ùå | `1aB2cD3eF4...` |
| `OPENAI_API_KEY` | API –∫–ª—é—á OpenAI | ‚úÖ | `sk-proj-...` |
| `STATISTICS_SHEET_ID` | ID —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è | ‚ùå | `1aB2cD3eF4...` |

---

## Logging

### Log Levels

```python
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
```

### Log Messages

- `INFO`: –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞, —É—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `ERROR`: –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏, API –æ—à–∏–±–∫–∏

### Examples

```
2025-01-15 19:05:00 - bot - INFO - ü§ñ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω!
2025-01-15 19:05:10 - bot - ERROR - –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–æ—Ç–æ: ...
```
